// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs

Table friends {
  following_user_id integer [pk]
  followed_user_id integer [pk]
  is_accepted boolean
}

Table users {
  id integer [primary key]
  avatar string
  email email
  password varchar
  username varchar
  role_id integer
}

Table roles {
  id integer [primary key]
  title varchar
}

Table places {
  id integer [primary key]
  title varchar
  description varchar
  lat float
  lon float
  locality_id integer
}

Table place_comments {
  id integer [primary key]
  comment varchar
  author_id integer
  place_id integer
}

Table localities {
  id integer [primary key]
  title varchar
}

Table place_images {
  id integer [primary key]
  path varchar
  place_id integer
}

Table routes {
  id integer [primary key]
  title varchar
  creator_id integer
}

Table favorite_user_routes {
  user_id integer [pk]
  route_id integer [pk]
}

Table route_points {
  id integer [primary key]
  index integer
  place_id integer
  route_id integer
}

Table chats {
  id integer [primary key]
  title varchar
  route_id integer
  creator_id integer
}

Table chat_messages {
  id integer [primary key]
  message varchar
  sender_id integer
  chat_id integer
}

Table chats_users {
  user_id integer [pk]
  chat_id integer [pk]
}

Table achievements {
  id integer [primary key]
  title varchar
  description varchar
  target integer
}

Table achievements_users_progress {
  user_id integer [pk]
  achievement_id integer [pk]
  current_progress integer
}

Table user_route_progress {
  user_id integer [pk]
  route_point_id integer [pk]
  is_completed boolean
}

Table user_rate_places {
  user_id integer [pk]
  place_id integer [pk]
  rate float
}

Table route_comments {
  id integer [primary key]
  comment varchar
  author_id integer
  route_id integer
}

Table user_rate_routes {
  user_id integer [pk]
  route_id integer [pk]
  rate float
}

Table user_active_routes {
  user_id integer [pk]
  route_id integer [pk]
}

Ref: routes.id - user_active_routes.route_id

Ref: users.id - user_active_routes.user_id

Ref: routes.id < user_rate_routes.route_id

Ref: users.id < user_rate_routes.user_id

Ref: routes.id < route_comments.route_id

Ref: users.id < route_comments.author_id

Ref: users.id < user_rate_places.user_id

Ref: places.id < user_rate_places.place_id

Ref: route_points.id < user_route_progress.route_point_id

Ref: users.id < user_route_progress.user_id

Ref: users.id < achievements_users_progress.user_id

Ref: achievements.id < achievements_users_progress.achievement_id

Ref: users.id < chats_users.user_id

Ref: chats.id < chats_users.chat_id

Ref: routes.id < chats.route_id

Ref: chat_messages.chat_id > chats.id

Ref: chat_messages.sender_id > users.id

Ref: chats.creator_id > users.id

Ref: place_comments.place_id > places.id

Ref: place_comments.author_id > users.id

Ref: routes.creator_id > users.id

Ref: route_points.place_id > places.id

Ref: route_points.route_id > routes.id

Ref: favorite_user_routes.route_id > routes.id

Ref: favorite_user_routes.user_id > users.id

Ref: place_images.place_id > places.id

Ref: localities.id - places.locality_id

Ref: roles.id < users.role_id

Ref: users.id < friends.following_user_id

Ref: users.id < friends.followed_user_id